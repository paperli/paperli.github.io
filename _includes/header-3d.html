<div class="hero" id="hero">
	<div class="cover-letter-box">
		<div id="cover-letter" class="container">
			<div class="row mb-3 mt-4 ml-0 name-box">
				<h1 class="flex-shrink-0 mr-4">Paper Lee</h1>
				<ul id="links" class="flex-shrink-1 d-flex align-items-center">
					<li class="link">
						<a id="link-mail" href="mailto:paper.li@gmail.com" alt="paper.li@gmail.com" title="paper.li@gmail.com" role="button" target="_blank"></a>
					</li>
					<li class="link">
						<a id="link-twitter" href="https://twitter.com/@paperli" alt="@paperli" title="@paperli" role="button" target="_blank"></a>
					</li>
					<li class="link">
						<a id="link-linkedin" href="http://www.linkedin.com/in/paperli" alt="LinkedIn" title="LinkedIn" role="button" target="_blank"></a>
					</li>
					<li class="link">
						<a id="link-blog" href="http://paperworkstud.io/blog/" alt="Blog" title="Blog" role="button" target="_blank"></a>
					</li>
					<li class="link">
						<a id="link-cv" href="{{ '/assets/raw/cv.pdf' | relative_url }}" alt="CV" title="CV" role="button" target="_blank"></a>
					</li>
				</ul>
			</div>
			<div class="row personal-info d-flex flex-column ml-0 flex-grow-1">
				<ul class="description d-none d-lg-block">
					<li>I do USER INTERFACE design</li>
					<li>I love TECH â™¥ ART</li>
					<li>I write .HTML</li>
				</ul>
				<div class="arkit-badge-box flex-grow-1 d-flex d-lg-none">
					<a href="{{ '/assets/models/vr/vr_playground_ar.usdz' | relative_url }}" rel="ar">
						<img src="{{ '/assets/images/arkit_badge.png' | relative_url }}" alt="ARKit">
					</a>
				</div>
				<div class="short d-flex d-lg-none justify-content-center"><span class="align-self-end mb-3">UI | TECH*ART | .HTML | XR</span></div>
			</div>
		</div>
	</div>
</div>

<script type="module">
	import * as THREE from "{{ '/assets/js/threejs/build/three.module.js' | relative_url }}";
	import { OrbitControls } from "{{ '/assets/js/threejs/examples/jsm/controls/OrbitControls.js' }}";
	import { GLTFLoader } from "{{ '/assets/js/threejs/examples/jsm/loaders/GLTFLoader.js' }}";

	var container, stats, controls;
	var camera, scene, renderer;
	const BACKGROUND_COLOR = 0x2A0F10;
	const FOG_NEAR = 6;
	const FOG_FAR = 16;
	const FOG_COLOR = BACKGROUND_COLOR;

	init();
	animate();

	function init() {
		container = document.createElement('div');
		var hero = document.getElementById('hero');
		hero.appendChild(container);

		camera = new THREE.PerspectiveCamera( 45, hero.offsetWidth / hero.offsetHeight, 0.25, 20);
		camera.position.set(-0.41, 4.255, 7.795);
		camera.rotation.set(-0.259, 0.146, 0.039);

		scene = new THREE.Scene();
		scene.background = new THREE.Color(BACKGROUND_COLOR);
		//scene.fog = new THREE.Fog(FOG_COLOR, FOG_NEAR, FOG_FAR);
		//scene.fog = new THREE.FogExp2(FOG_COLOR, 0.08);

		var loader = new GLTFLoader().setPath("{{ '/assets/models/vr/' | relative_url }}");
		loader.load('vr_playground.gltf', function(gltf) {
			// load successful
			console.log("Load gltf successful");
			var light_count = 0;
			gltf.scene.traverse(function(child) {
				if (child.isLight) {
					// reduce lights' intensity
					//child.visible = false;
					child.intensity = 1;
					light_count++;
					if (light_count == 2) {
						// oly the 2nd light casts shadow
						child.castShadow = true;
					}
					
				} else if (child.isMesh) {
					console.log("current node: " + child.name);
					// Only stage receives shadow but don't cast shadow
					// TODO: Only headset casts shadow? To reduce performance impact
					child.receiveShadow = (child.name == "Stage") ? true : false;
					child.castShadow = (child.name == "Stage") ? false : true;
				}
			});
			scene.add(gltf.scene);
		});

		renderer = new THREE.WebGLRenderer( {antialias: true} );
		renderer.setPixelRatio(window.devicePixelRatio);
		renderer.setSize(hero.offsetWidth, hero.offsetHeight);
		renderer.gammaOutput = true;
		renderer.shadowMapEnabled = true;
		renderer.shadowMapType = THREE.PCFSoftShadowMap;
		container.appendChild(renderer.domElement);

		// Orbit controls
		/*controls = new OrbitControls( camera, renderer.domElement );
		controls.target.set( 0, - 0.2, - 0.2 );
		controls.update();*/

		// Disable window resizing to avoid weird stretching of canvas
		// TOFIX: handle window resizing
		//window.addEventListener('resize', onWindowResize, false);
		//window.addEventListener('orientationchange', onWindowResize, false);
		
		// For getting camera's transform
		//document.body.addEventListener('mouseup', onBodyClick, true);
	}

	function onWindowResize() {
		var hero = document.getElementById('hero');
		camera.aspect = hero.offsetHeight / hero.offsetHeight;
		camera.updateProjectionMatrix();

		renderer.setSize(hero.offsetWidth, hero.offsetHeight);
	}

	function onBodyClick() {
		console.log("camera pos: " + camera.position.x + ", " + camera.position.y + ", " + camera.position.z);
		console.log("camera rot: " + camera.rotation.x + ", " + camera.rotation.y + ", " + camera.rotation.z);
		console.log("camera scale: " + camera.scale.x + ", " + camera.scale.y + ", " + camera.scale.z);
	}

	function animate() {
		requestAnimationFrame(animate);
		renderer.render(scene, camera);

	}
</script>
